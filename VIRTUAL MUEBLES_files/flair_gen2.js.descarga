(()=>{var h=function(){return{version:"2.20240220",config:{app:{},shop:{}},debug:window.location.search.includes("flairdebug"),init:function(e){e||={},e.app&&(this.config.app=e.app),e.shop&&(this.config.shop=e.shop),this.config.app.refresh_on_init&&(this.refreshProductBadges(),this.refreshBanners()),this.initBadgeVariantRefresh(),this.initBannerCountdown()},initBadgeVariantRefresh:function(){var e=this.config.app.badge_variant_refresh||{};if(e.enabled){var t=e.selector||".single-option-selector",r=e.parent_selector||'form[action="/cart/add"]',n=e.type;this.debug&&console.log("[Flair] initBadgeVariantRefresh",n,r,t);var a=function(){var d=e.delay||100;setTimeout(function(){this.refreshProductBadges()}.bind(this),d)}.bind(this),i=document.querySelectorAll(r);i.size==0&&(this.debug&&console.log("[Flair] WARNING initBadgeVariantRefresh parent selector could not be found, using document",r),i=[document]);for(var o=0;o<i.length;o++){var s=i[o];this.debug&&console.log("[Flair] initBadgeVariantRefresh adding event listener",s),s.addEventListener(n,function(d){d.target.matches(t)&&(this.debug&&console.log("[Flair] variant refresh event detected",n,r,t),a())})}}},currentVariantId:function(){var e=document.querySelector("[name=id]");return e?e.value:window.location.search.replace(/.*variant=(\d+).*/,"$1")},getBanners:function(e){e=e||{};var t={};return t.layout=e.layout,t.sections="flair-banners",this.debug&&console.log("[Flair] getBanners",t),this.getSections(t).then(function(r){var n=JSON.parse(r),a=n["flair-banners"];return this.debug&&console.log("[Flair] getBanners result",a),a}.bind(this))},getProductBadges:function(e){if(e=e||{},e.url)return this.getProductBadgesByUrl(e);var t={};return e.ids?t.ids=e.ids:this.config.shop.product_id&&(t.ids=[this.config.shop.product_id]),t.layout=e.layout,t.sections="flair-product-badges",this.debug&&console.log("[Flair] getProductBadges",t),this.getSections(t).then(function(r){var n=JSON.parse(r),a=n["flair-product-badges"];return this.debug&&console.log("[Flair] getProductBadges result",a),a}.bind(this))},getProductBadgesByUrl:function(e){e=e||{};var t=e.url||window.location.href,r=e.section||"flair-product-badges",n={section_id:r};return e.variant&&(n.variant=e.variant),t=this.buildUrl(t,n),this.getUrl(t)},getProductBadgesMulti:function(e){return this.getProductBadges(e)},getSections(e){e=e||{};var t=e.ids||[],r=e.sections||"flair-product-badges,flair-banners",n=[],a=e.ids||[];a.length==0&&this.config.shop.product_id&&a.unshift(this.config.shop.product_id);for(var i=0;i<a.length;i++)n.push("id:"+a[i].toString());if(e.layout){var o=e.layout;/\s/.test(o)&&(o='"'+o+'"'),n.push("_lay:"+o)}var s=this.currentVariantId();this.config.shop.product_id&&s&&n.push("_var:"+this.config.shop.product_id.toString()+"|"+s.toString()),this.config.shop.collection_handle&&n.push("_col:"+this.config.shop.collection_handle),this.config.shop.page_type&&n.push("_pag:"+this.config.shop.page_type);var d={q:n.join(" OR "),sections:r},l=this.buildUrl(this.config.shop.search_url||"/search",d);return this.getUrl(l)},insertBanners:function(e){var t=document.createElement("div");t.innerHTML=e,this.updateBannerCountdown(t);for(var r=t.querySelectorAll("[data-flair-banner]"),n=0;n<r.length;n++){var a=r[n],i=a.dataset.layout||"",o="[data-flair-banner]";i!=""&&(i=i.toString().replace(/"/g,""),o+='[data-layout="'+i+'"]');for(var s=document.querySelectorAll(o),d=!1,l=0;l<s.length;l++){var u=s[l],f=u.dataset.layout||"";if(i==f){var c=a.cloneNode(!0);u.parentNode.replaceChild(c,u),d=!0}}!d&&this.debug&&console.log("[Flair] WARNING insertBanners unable to find match, banners were not inserted, layout:",i)}},insertProductBadges:function(e){var t=document.createElement("div");t.innerHTML=e;for(var r=t.querySelectorAll("[data-flair-product-badge]"),n=0;n<r.length;n++){var a=r[n],i=a.dataset.productId||0,o=a.dataset.layout||"",s='[data-flair-product-badge][data-product-id="'+i.toString()+'"]';o!=""&&(o=o.toString().replace(/"/g,""),s+='[data-layout="'+o+'"]');for(var d=document.querySelectorAll(s),l=!1,u=0;u<d.length;u++){var f=d[u],c=f.dataset.layout||"";if(o==c){var g=a.cloneNode(!0);f.parentNode.replaceChild(g,f),l=!0}}!l&&this.debug&&console.log("[Flair] WARNING insertProductBadges unable to find match, badges were not inserted - product id, layout:",i,o)}},refreshBanners:function(){for(var e=document.querySelectorAll("[data-flair-banner]"),t={},r=0;r<e.length;r++){var n=e[r],a=n.dataset.layout||"";t[a]=!0}for(var i=Object.keys(t),r=0;r<i.length;r++){var a=i[r];this.getBanners({layout:a}).then(function(d){this.insertBanners(d)}.bind(this))}},refreshProductBadges:function(){for(var e=document.querySelectorAll("[data-flair-product-badge]"),t={},r=0;r<e.length;r++){var n=e[r],a=n.dataset.layout||"",i=n.dataset.productId;i&&(t[a]=t[a]||[],t[a].indexOf(i)==-1&&t[a].push(i))}for(var o=Object.keys(t),r=0;r<o.length;r++){var a=o[r];this.getProductBadges({ids:t[o[r]],layout:a}).then(function(l){this.insertProductBadges(l)}.bind(this))}},buildUrl:function(e,t){var r=e;if(t){r=r.split("?")[0];for(var n=Object.keys(t),a=0;a<n.length;a++){a==0?r+="?":r+="&";var i=n[a];r+=i+"="+t[i]}}return r},getUrl:function(e){var t=fetch(e).then(function(r){return r.ok?r.text():(console.log("[Flair] Error fetching url",r.status),"")}).then(function(r){return r}).catch(function(r){return console.log("[Flair] Error getting url",r),""});return t},initBannerCountdown:function(){var e=this.config.app.banner_countdown_enabled;if(e){var t=1e3,r=function(){this.updateBannerCountdown(document),setTimeout(function(){r()},t)}.bind(this);r()}},updateBannerCountdown:function(e){var t=e.querySelectorAll(".flair-banner-countdown");function r(c){return c<10?"0"+c:c}for(var n=0;n<t.length;n++){var a=t[n],i=a.dataset.time*1e3,o=new Date().getTime(),s=i-o;if(s>0){a.style.display="inline-flex";var d=Math.floor(s/(1e3*60*60*24)),l=Math.floor(s%(1e3*60*60*24)/(1e3*60*60)),u=Math.floor(s%(1e3*60*60)/(1e3*60)),f=Math.floor(s%(1e3*60)/1e3);a.querySelector("[data-day]").innerText=r(d),a.querySelector("[data-hour]").innerText=r(l),a.querySelector("[data-minute]").innerText=r(u),a.querySelector("[data-second]").innerText=r(f),d==0&&a.querySelectorAll('[data-section="day"]').forEach(function(c){c.style.display="none"})}else a.style.display="none"}}}}();window.FlairApp=h;var v=h;})();
